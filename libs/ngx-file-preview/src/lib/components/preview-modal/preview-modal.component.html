<div class="preview-modal-overlay" *ngIf="isVisible" (click)="close()">
  <div class="preview-modal-content"
       (click)="$event.stopPropagation()"
       (mousemove)="handleMouseMove()"
       (mouseleave)="hideControls()">
    <div class="preview-modal-header" [class.has-multiple]="hasMultipleFiles">
      <div class="header-left">
        <span class="file-name">{{ currentFile?.name }}</span>
        <span class="file-index" *ngIf="hasMultipleFiles">{{ getCurrentFileInfo() }}</span>
      </div>
      <div class="header-right">
        <div class="theme-toggle" (click)="toggleTheme()">
          <svg *ngIf="(theme$|async)=='light'" width="20px" height="20px" viewBox="0 0 24 24">
            <path fill="currentColor"
                  d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5s5-2.24 5-5s-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58a.996.996 0 0 0-1.41 0a.996.996 0 0 0 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37a.996.996 0 0 0-1.41 0a.996.996 0 0 0 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0a.996.996 0 0 0 0-1.41l-1.06-1.06zm1.06-10.96a.996.996 0 0 0 0-1.41a.996.996 0 0 0-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36a.996.996 0 0 0 0-1.41a.996.996 0 0 0-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"/>
          </svg>
          <svg *ngIf="(theme$|async)=='dark'" width="20px" height="20px" viewBox="0 0 24 24">
            <path fill="currentColor"
                  d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9s9-4.03 9-9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 0 1-4.4 2.26a5.403 5.403 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1z"/>
          </svg>
        </div>
        <preview-icon name="close" [themeMode]="theme$|async" (click)="close()"></preview-icon>
      </div>
    </div>
    <div class="preview-modal-body">
      <button class="nav-button prev"
              *ngIf="canShowPrevious()"
              [class.visible]="isControlsVisible"
              (click)="previous()">
        <preview-icon [themeMode]="themeMode" [size]="36" name="previous"></preview-icon>
      </button>

      <div class="preview-content">
        <ng-container [ngSwitch]="currentFile?.type">
          <ngx-image-preview
            *ngSwitchCase="'image'"
            [file]="currentFile!"
            [themeMode]="theme$|async"
          ></ngx-image-preview>

          <ngx-video-preview
            *ngSwitchCase="'video'"
            [file]="currentFile!"
            [themeMode]="theme$|async"
          ></ngx-video-preview>

          <ngx-pdf-preview
            *ngSwitchCase="'pdf'"
            [file]="currentFile!"
            [themeMode]="theme$|async"
          ></ngx-pdf-preview>

          <ngx-word-preview
            *ngSwitchCase="'word'"
            [file]="currentFile!"
            [themeMode]="theme$|async"
          ></ngx-word-preview>

          <ngx-excel-preview
            *ngSwitchCase="'excel'"
            [file]="currentFile!"
            [themeMode]="theme$|async"
          ></ngx-excel-preview>

          <ngx-ppt-preview
            *ngSwitchCase="'ppt'"
            [file]="currentFile!"
            [themeMode]="theme$|async"
          ></ngx-ppt-preview>

          <ngx-text-preview
            *ngSwitchCase="'txt'"
            [file]="currentFile!"
            [themeMode]="theme$|async"
          ></ngx-text-preview>

          <ngx-markdown-preview
            *ngSwitchCase="'markdown'"
            [file]="currentFile!"
            [themeMode]="theme$|async"
          ></ngx-markdown-preview>

          <ngx-archive-preview
            *ngSwitchCase="'zip'"
            [file]="currentFile!"
            [themeMode]="theme$|async"
          ></ngx-archive-preview>

          <ngx-audio-preview
            *ngSwitchCase="'audio'"
            [file]="currentFile!"
            [themeMode]="theme$|async"
          ></ngx-audio-preview>

          <ngx-unknown-preview
            *ngSwitchCase="'unknown'"
            [file]="currentFile!">
            [themeMode]="theme$|async"
          </ngx-unknown-preview>
        </ng-container>
      </div>

      <button class="nav-button next"
              *ngIf="canShowNext()"
              [class.visible]="isControlsVisible"
              (click)="next()">
        <preview-icon [themeMode]="themeMode" [size]="36" name="next"></preview-icon>
      </button>
    </div>
  </div>
</div>
